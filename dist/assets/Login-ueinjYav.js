import{c as O,a as t,y as z,u as W,t as Y,j as e,m as i,A as G}from"./index-j_6VHDZj.js";import{B as h}from"./button-CM-wuY8d.js";import{I as N}from"./input-DnWmI6bX.js";import{C as q,L as v}from"./label-Bj7rIrHy.js";import{C as J,a as Q,b as X,c as Z,d as _}from"./card-Dq5jj9B5.js";import{D as $,a as ee,b as ae,c as se,d as te}from"./dialog-B-5RBCDx.js";import{u as re,P as ie}from"./useAnalytics-D0C5s9-A.js";import{S as le}from"./shield-B5hIhGs0.js";import{C as ne}from"./circle-check-big-CeB9Blxe.js";import{M as ce}from"./mail-Dd-NxaZi.js";import{L as oe}from"./lock-DhwIjH5f.js";import{E as de,L as A}from"./loader-circle-B1IZUj-f.js";import{E as me}from"./eye-tnDFcuJU.js";import"./component-C_dOosIV.js";/**
 * @license lucide-react v0.448.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=O("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);function Ee(){const[u,K]=t.useState(!1),[x,T]=t.useState(""),[p,F]=t.useState(""),[U,w]=t.useState(""),[l,c]=t.useState(""),[y,n]=t.useState(!1),[C,s]=t.useState(""),[S,g]=t.useState(""),[f,D]=t.useState(!1),[o,j]=t.useState(0),[k,b]=t.useState(null),{verifyCredentials:V,verifyDepartmentCode:M,completeLogin:R,isLoading:E,isAuthenticated:L}=z();re();const d=W(),m=Y().state?.from?.pathname||"/dashboard";t.useEffect(()=>{L&&d(m,{replace:!0})},[L,d,m]),t.useEffect(()=>{y||(c(""),s(""),j(0))},[y]);const B=async a=>{if(a.preventDefault(),s(""),g(""),!x||!p){s("Please fill in all fields");return}const r=await V(x,p);if(r.success)if(r.requiresDepartmentCode)b(r.userId),w(r.department),n(!0);else{const I=await R(r.userId);I.success?(g("Login successful! Redirecting to dashboard..."),setTimeout(()=>{d(m,{replace:!0})},1e3)):s(I.error||"Login failed")}else s(r.error||"Invalid credentials")},P=async()=>{if(!l){s("Please enter your department code");return}if(!k){s("Session expired. Please try logging in again.");return}D(!0),s("");try{const a=await M(k,l);a.success?(g("Department code verified! Redirecting to dashboard..."),n(!1),setTimeout(()=>{d(m,{replace:!0})},1e3)):(j(r=>r+1),a.error==="expired code"?s("Your department code has expired. Please contact your administrator."):a.error==="invalid code"?s("Invalid department code. Please check and try again."):s(a.error||"Department code verification failed"),o>=2&&setTimeout(()=>{n(!1),w(""),c(""),b(null),s("Too many failed attempts. Please contact your administrator.")},2e3))}catch{s("Failed to verify department code. Please try again.")}finally{D(!1)}},H=()=>{n(!1),c(""),s(""),j(0),b(null)};return e.jsx(ie,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-arch-light-blue via-white to-arch-light-blue/30 flex items-center justify-center p-4",children:[e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"text-center mb-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-arch-orange to-arch-rust rounded-2xl flex items-center justify-center shadow-lg",children:e.jsx(le,{className:"h-8 w-8 text-white"})})}),e.jsx("h1",{className:"text-3xl font-bold text-arch-charcoal mb-2",children:"Welcome Back"}),e.jsx("p",{className:"text-arch-blue-gray",children:"Sign in to access your dashboard"})]}),e.jsxs(J,{className:"border-arch-light-blue/50 shadow-xl",children:[e.jsxs(Q,{className:"text-center pb-4",children:[e.jsx(X,{className:"text-xl text-arch-charcoal",children:"Sign In"}),e.jsx(Z,{className:"text-arch-blue-gray",children:"Enter your credentials to continue"})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsx(G,{children:C&&e.jsxs(i.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-4 bg-red-50 border border-red-200 rounded-lg flex items-center gap-3",children:[e.jsx(q,{className:"h-5 w-5 text-red-500 flex-shrink-0"}),e.jsx("span",{className:"text-red-700 text-sm",children:C})]})}),S&&e.jsxs(i.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-4 bg-green-50 border border-green-200 rounded-lg flex items-center gap-3",children:[e.jsx(ne,{className:"h-5 w-5 text-green-500 flex-shrink-0"}),e.jsx("span",{className:"text-green-700 text-sm",children:S})]}),e.jsxs(i.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.2},className:"space-y-2",children:[e.jsx(v,{htmlFor:"email",className:"text-arch-charcoal font-medium",children:"Email Address"}),e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-arch-blue-gray"}),e.jsx(N,{id:"email",type:"email",placeholder:"Enter your email",value:x,onChange:a=>T(a.target.value),className:"pl-10 h-12 border-arch-light-blue/50 focus:border-arch-orange",required:!0})]})]}),e.jsxs(i.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.3},className:"space-y-2",children:[e.jsx(v,{htmlFor:"password",className:"text-arch-charcoal font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-arch-blue-gray"}),e.jsx(N,{id:"password",type:u?"text":"password",placeholder:"Enter your password",value:p,onChange:a=>F(a.target.value),className:"pl-10 pr-10 h-12 border-arch-light-blue/50 focus:border-arch-orange",required:!0}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-12 px-3 py-2 hover:bg-transparent",onClick:()=>K(!u),children:u?e.jsx(de,{className:"h-4 w-4 text-arch-blue-gray"}):e.jsx(me,{className:"h-4 w-4 text-arch-blue-gray"})})]})]}),e.jsx(i.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{duration:.5,delay:.4},children:e.jsx(h,{type:"submit",className:"w-full h-12 bg-arch-orange hover:bg-arch-rust text-white font-medium",disabled:E,children:E?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Signing in..."})]}):"Sign In"})})]})})]})]}),e.jsx($,{open:y,onOpenChange:n,children:e.jsxs(ee,{className:"sm:max-w-md",children:[e.jsxs(ae,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-arch-orange"}),"Department Code Required"]}),e.jsxs(te,{children:["Please enter your 5-6 character department code to complete login for ",U,"."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"unique-key",children:"Department Code"}),e.jsx(N,{id:"unique-key",placeholder:"Enter your department code",value:l,onChange:a=>{const r=a.target.value.toUpperCase().slice(0,6);c(r)},maxLength:6,autoFocus:!0,onKeyDown:a=>{a.key==="Enter"&&P()}})]}),e.jsx("p",{className:"text-xs text-arch-blue-gray",children:"Format: 5-6 characters (e.g., SA1234, AC5930)"})]}),o>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-yellow-700",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsxs("span",{className:"text-sm",children:["Attempt ",o,"/3 -"," ",3-o," attempts remaining"]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{variant:"outline",onClick:H,className:"flex-1 border-arch-light-blue text-arch-charcoal hover:bg-arch-light-blue/20",disabled:f,children:"Cancel"}),e.jsx(h,{onClick:P,disabled:!l||l.length<5||f,className:"flex-1 bg-arch-orange hover:bg-arch-rust text-white",children:f?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):"Verify Code"})]})]})})]})})}export{Ee as default};
